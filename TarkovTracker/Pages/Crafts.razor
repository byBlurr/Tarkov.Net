@page "/crafts"
@using Tarkov.Entities;
@using Tarkov.Enums;
@using Tarkov;
@using TarkovTracker.Components
@using TarkovTracker.Data;
<PageTitle>Crafts</PageTitle>

<h2>Crafts</h2>	
@if (AmmoCrafts != null)
{
	<div style="max-width:850px; height:auto;">
		<h4>Ammo Crafts</h4>
		<div style="display: flex; align-content:center;  text-align:center;">
			@if (ShowAmmoCrafts)
			{
				<a><button class="btn btn-primary" @onclick="ToggleAmmoAsync">Hide</button></a>
				<a><button class="btn btn-primary" @onclick="() => SetWorkbenchLevel(1)">Level 1</button></a>
				<a><button class="btn btn-primary" @onclick="() => SetWorkbenchLevel(2)">Level 2</button></a>
				<a><button class="btn btn-primary" @onclick="() => SetWorkbenchLevel(3)">Level 3</button></a>
				<a><button class="btn btn-primary" @onclick="() => SetWorkbenchLevel(4)">Level 4</button></a>
			}
			else
			{
				<div><a><button class="btn btn-primary" @onclick="ToggleAmmoAsync">Show</button></a></div>
			}
		</div>
			<div class="card-group" style="display:grid; grid-template-columns: 1fr 1fr; column-gap: 5px; max-width:inherit; height:inherit;">
			@if (ShowAmmoCrafts)
			{
				@foreach (Craft craft in AmmoCrafts)
				{
					@if  (craft.Level <= MaxWorkbenchLevel)
					{
						<CraftDisplay CraftItem=@craft.RewardItems[0] RequiredItems=@craft.RequiredItems CraftTime=@craft.Duration />
					}
				}
			}
		</div>
	</div>
}

@code {
	private bool ShowFuelCover = true;
	private bool ShowAmmoCrafts = false;

	private bool ShowWorkbenchCrafts = false;
	private int MaxWorkbenchLevel = 4;
	private bool ShowMedCrafts = false;
	private int MaxMedLevel = 4;
	private bool ShowLavCrafts = false;
	private int MaxLavLevel = 4;
	private bool ShowIntelCrafts = false;
	private int MaxIntelLevel = 4;
	private bool ShowFoodCrafts = false;
	private int MaxFoodLevel = 4;

	private List<Craft> FuelCoverCrafts;
	private List<Craft> AmmoCrafts;

	protected override async Task OnInitializedAsync()
	{
		while (!Cache.Completed) await Task.Delay(100);

		FuelCoverCrafts = new List<Craft>();


		AmmoCrafts = new List<Craft>();
		foreach (Craft craft in Cache.WorkbenchCrafts.Values)
		{
			if (craft.RewardItems[0].Item.Category.Name.ToLower().Equals("ammo")) AmmoCrafts.Add(craft);
		}

		StateHasChanged();
	}

	private async Task ToggleAmmoAsync() => ShowAmmoCrafts = !ShowAmmoCrafts;
	private void SetWorkbenchLevel(int lvl) => MaxWorkbenchLevel = lvl;
	private void SetMedLevel(int lvl) => MaxMedLevel = lvl;
	private void SetLavLevel(int lvl) => MaxLavLevel = lvl;
	private void SetIntelLevel(int lvl) => MaxIntelLevel = lvl;
	private void SetFoodLevel(int lvl) => MaxFoodLevel = lvl;
}
